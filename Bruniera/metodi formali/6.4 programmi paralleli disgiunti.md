# Programmi paralleli disgiunti

Intuitivamente sono quelli in cui le variabili condivise sono in sola lettura.

> ***Definizione (programmi disgiunti)***: Siano $S_1,S_2$ programmi deterministici. Si dicono disgiunti se:
>
> $$change(S_1)\cap var(S_2)=\emptyset\land change(S_2)\cap var(S_1)=\emptyset$$
>
> Quindi, se nessuna delle variabili usate in $S_2$ viene modificata da $S_1$ e viceversa.

> ***Definizione (programmi paralleli disgiunti)***: I programmi paralleli disgiunti sono i programmi deterministici, estesi col costrutto: `[ S1 | ... | Sn ]` in cui $S_1,..,S_n$ sono programmi *deterministici* a due a due *disgiunti*.
>
> Il costrutto non può essere "annidato" poiché si possono parallelizzare solo programmi deterministici.

## Semantica transazionale

Come viene eseguito un programma `[ S1 | ... | Sn ]`? Aggiungiamo alcune regole al sistema di transizione:

$$
\begin{align}
&\frac{\langle S_i,\sigma\rangle\rightarrow\langle S'_1,\sigma'\rangle}{\langle[S_1 | ... | S_i | ... | S_n],\sigma\rangle\rightarrow\langle[S_1 | ... | S'_i | ... | S_n],\sigma'\rangle} & \text{interleaving}
\end{align}
$$

Con questa regola il sistema diventa non-deterministico, perché per una stessa configurazione esistono più possibili transizioni, e ne può essere eseguita una qualsiasi.

Tuttavia, grazie all'ipotesi di disgiunzione, si può dimostrare che lo stato finale è uno solo.

## Regole ausiliarie

Possiamo aggiungere a PD e TD, alcune regole ausiliarie che non sono necessarie per la completezza ma sono comode per le dimostrazioni.

$$
\begin{align}
&\frac{free(p)\cap change(S)=\emptyset}{\{p\}~S~\{p\}} & \text{invarianza}\\
&\frac{\{p\}~S~\{q\}\quad\{r\}~S~\{q\}}{\{p\land r\}~S~\{q\}} & \text{disgiunzione}\\
&\frac{\{p\}~S~\{p'\}\quad\{q\}~S~\{q'\}}{\{p\lor q\}~S~\{p'\lor q'\}} & \text{disgiunzione}\\
&\frac{\{p\}~S~\{q\}\quad x\notin var(S)\cup free(q)}{\{\exist x:p\}~S~\{q\}} & \exist\text{-introduzione}\\
&\frac{\{r\}~S~\{q\}\quad free(p)\cap change(S)=\emptyset}{\{p\land r\}~S~\{p\land q\}} & \text{invarianza}
\end{align}
$$

## Sequenzializzazione

> ***Definizione***: Due sistemi

## Sistema di riduzioni

> ***Definizione***: Un sistema di transizioni è una coppia $(A,\rightarrow)$ dove $A$ è un dominio, e $\rightarrow$ è una relazione binaria $\rightarrow\subseteq A\times A$.

Un sistema di transizioni è un sistema di riduzioni.

> ***Definizione (diamond property)***: $(A,\rightarrow)$ soddisfa la proprietà $\diamond$ se $\forall_{a,b,c\in A}.(b\neq c~\land~a\rightarrow b~\land~a\rightarrow c)\rightarrow\exists_{d\in A}.(b\rightarrow d~\land~c\rightarrow d)$
>
> ***Definizione (confluence property)***: $(A,\rightarrow)$ soddisfa la è confluente se $\forall_{a,b,c\in A}.(b\neq c~\land~a\rightarrow^* b~\land~a\rightarrow^* c)\rightarrow\exists_{d\in A}.(b\rightarrow^* d~\land~c\rightarrow^* d)$
>
> È simile a $\diamond$ ma con step indefiniti.

Dimostriamo alcuni lemmi

> ***Lemma (A)***: Se $(A,\rightarrow)$ soddisfa $\diamond$, allora $\forall a,b$ e $\forall c_1,...,c_n$ tali che $a\rightarrow b\land a\rightarrow c_1$ e $c_i\rightarrow c_{i+1}$ abbiamo che $\exist d,i\leq n$ tali che $c_n\rightarrow d$ e $b\rightarrow^i d$.\
> ***Dimostrazione***: Si dimostra per induzione su $n$ sfruttando la proprietà $\diamond$ per aggiungere sempre un altro step.
> 
> ***Lemma***: Se $(A,\rightarrow)$ soddisfa $\diamond$ allora è confluente\
> ***Dimostrazione***: Si dimostra per induzione sugli step in $a\rightarrow^* b$ sfruttando il lemma A
>
> ***Lemma (infinite)***: Se $(A,\rightarrow)$ soddisfa $\diamond$ e $b\neq c$, ed esiste una sequenza infinita $a\rightarrow b\rightarrow...$, allora esiste una sequenza infinita $a\rightarrow c\rightarrow...$\
> ***Dimostrazione***: Partendo dalla sequenza $a\rightarrow b\rightarrow...$ costruiamo la sequenza $a\rightarrow c\rightarrow...$ usando $\diamond$ per costruire ogni step

> ***Definizione (massimale e yield)***: Sia $(A,\rightarrow)$, $b\in A$ si dice massimale se $\not\exist c.b\rightarrow c$, è simile a dire che $b$ è uno stato finale.
>
> $$yield(a)=\{a|a\rightarrow^*b\land b~\mathrm{massimale}\}\cup\{\bot|a\rightarrow...\}$$

> ***Lemma (yield)***: Se $(A,\rightarrow)$ soddisfa $\diamond$, allora $\forall a.|yield(a)|=1$
>
> ***Dimostrazione***: Supponiamo per assurdo che $(A,\rightarrow)$ soddisfa $\diamond$ e per qualche  $a$ si ha $|yield(a)|>1$, allora:
> * $a\rightarrow^*c$, e $a\rightarrow^*b$ con $c\neq b$ e $c,b$ massimali
>   * Allora per confluenza esiste $d$ tale che $c\rightarrow^*d$ e $b\rightarrow^*d$, allora $b,c$ non sono massimali, assurdo
> * Se $a\rightarrow^*b$ con $b$ massimale e $a\rightarrow c\rightarrow...$
>   * Allora per infinite lemma $a\rightarrow b\rightarrow...$, allora $b$ non è massimale, assurdo
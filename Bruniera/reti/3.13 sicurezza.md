# Sicurezza

La sicurezza è una di quelle applicazioni che scono dall'architettura a livelli, richiede che livelli diversi collaborino.

Ormai tutte le risorse sono distribuite sulla rete. Nella preistoria le risorse erano fisicamente limitate, bisognava avere accesso fisico alla macchina per accedervi.
Anche negli ambienti in cui meno sembrava richiesta la rete, ora sono connesse. Ma per questo hanno meccanismi di sicurezza poco sviluppati, perché non servivano.

Strategia generale per la messa in sicurezza:
* Identificare gli asset da proteggere
  * Tempo CPU
  * Larghezza di banda
  * Contenuto di un DB
  * Controllo di macchinari
  * ...
* Decidere dei goal di sicurezza
  * Proprietà che vogliamo che le risorse soddisfino
  * Che non vogliamo che siano modificare da chi non è autorizzato
  * ...
* Stabilire politiche di sicurezza
  * Come reggiungere il goal
  * Insiemedi regole che garantiscono l'obbiettivo
    * Esempio:
      * Goal: non fare incidenti
      * Policies: codice della strada
* Identificare le minaccie
  * Causate da un malfunzionamento
  * Intenzionali
* Sviluppare servizi di sicurezza che implementino controlli/contromisure e piani di recupero
  * Insiemi di servizi che sevono a contrastare le minaccie
  * Servizi per recuperare nel caso la minaccia diventi un attacco

"La sicurezza ha un costo, ma l'insicurezza costa di più":
* La sicurezza si ottiene implementando servizi con costi:
  * Economici
  * Computazionali
  * Risorse umane per la manutenzione ed installazione
    * Ci si può affidare a terzi e trasformarle in costi economici
  * Design ed implementazione più complessi
    * Il software deve essere sviluppato a priori con la sicurezza in mente
    * A volte bisogna rifare il sistema da capo perché l'azienda ha una rete degli anni '70
  * Fastidio degli utenti
    * Chi usa i sistemi si lamenterà sempre
    * La sicurezza è vista come un ostacolo
* Mancanza di sicurezza può costare di più
  * Perdita di assets vitali
  * Conseguenze legali

La sicurezza è un compromesso tra tre aspetti:
* Sicurezza
* Funzionalità
* Facilità d'uso

Non possiamo massimizzare tutte e tre. Alcuni sistemi industriali o militari massimizzano sicurezza, ma hanno pochissimi servisi e nessuna facilità d'uso.

## Security goal

Obbiettivi di sicurezza:
* Confidenzialità:
  * Più facile da realizzare
  * Un'organizzazione deve riguardarsi contro azioni malevole che possono mettere a rischio la confidenzialità delle informazioni
* Integrità:
  * Le funzionalità di alterazione dello stato (che devono essere implementate) devono essere eseguite solo da entità autorizzate
  * Un'organizzazione deve proteggersi contro alterazioni non autorizzate
* Disponibilità
  * Le informazini memorizzate devono essere disponibili alle entità autorizzate quando sono richieste
  * un'organizzazione in cui le informazioni cambiano sempre devono rendere le informazioni sempre disponibili al personale autorizzato

Non tutte le organizzazioni sono interessate a tutto. Ad esempio, le pubblicazioni di atti ufficiali sono integre e disponibili, ma non confidenziali.
Non tutti possono modificare e pubblicare, ma le informazioni sono disponibili a tutti.

## Minacce, attacchi, servizi, meccanismi

* Minacce di sicurezza
  * La potenziale possibilità che avvenga una violazione di un goal di sicurezza
  * Magari non si verifica mai, ma è possibile
* Attacco
  * Un assalto deliberato che compromette i goal di sicurezza
  * Se esiste la posssibilità e l'interesse, prima o poi un attacco si verifica
* Servizi di sicurezza
  * Servizi che hanno lo scopo di incrementare la sicurezza per contrastare gli attacchi
  * Aggiungono funzionalità, ma non funzionalità utili
* Meccanismi
  * Come vengono implementati i servizi di sicurezza

Esempio:
* Nel computer del professore ci sono i testi degli esami (assets)
* Alcune persone sono interessate ad accedervi (minaccia)
* Il professore a volte abbandona il computer (vulnerabilità)
* Mentre è via, una persona non autorizzata può sedersi ed usare il computer (attacco)
* Contromisura: bisogna implementare un servizio di autenticazione che garantisca l'identità degli utenti del computer
* Alcuni meccanismi per implementare il servizio:
  * Nome e password
  * Impronta
  * Carta
  * Timbro vocale
  * Scansione della retina
  * Guardia di sicurezza

## Attacchi alla confidenzialità

* Snooping: Accesso non autorizzato ai dati
  * Accesso non autorizzato al computer (hacker, virus, password stupide, ...)
  * Intercettamento dei dati (sniffing)
    * Usa la cifratura, idiota!
* Analisi del traffico: Ottenimento di metadati monitorando il traffico online
  * Dai metadati si capiscono un sacco di informazioni, si può riconoscere l'utente anche senza ossercare il payload dei messaggi

## Attacchi all'integrità

* Modificha dei messaggi
  * Anche semplici ritardi o cancellazioni dei messaggi, possono farlo i router della sottorete
  * Spesso segue un attacco di snooping
* Masquerading o spoofing
  * L'attaccante finge di essere il mittente od il destinatario di un messaggio (man in the middle)
  * Si ottiene alterando i metadati
* Replay
  * Copia un messaggio di un utente e cerca di ripeterlo più tardi
  * Ascolta la password cifrata, non sa cosa c'è scritto, ma può reinviarla per eseguire di nuovo l'accesso
* Ripudio
  * Avviene da parte delle due parti della comunicazione, non da un terzo, significa che non c'è completa fiducia tra i due
  * Uno dei due riceve od invia un messaggio di cui si pente e dichiara di non averlo mai ricevuto od inviato
  * Per impedire di ripudiare l'invio è sufficiente una firma digitale, per la ricezione è più complicato, si usa la notifica di ricezione

## Attacchi alla disponibilità

Attacchi Denial of Service (DoS):
* È il meno importante
* Non modifica o scopre dati, semplicemente impedisce a chi di dovere di accedere ai dati
* È fastidioso, è molto facile, e si usa per boicottare gli altri
* Si implementa con grandi numeri di richieste
* Può essere implementato come molti attacchi coordinati da più attaccanti (Distributed DoS, DDoS)
* Contromisure:
  * Fare in modo che il carico dell'attaccante sia non inferiore al carico del bersaglio
    * Perché il server impegni x, l'attaccante deve impegnare almeno x
    * Il TCP è vulnerabile a SYN Flooding (non ho cpaito come si collega)
  * Dirottare le richieste malevole, se possibile

## Attacchi passivi/attivi

Gli attacchi passivi sono quelli che possono essere eseguiti senza influenzare il funzionamento del sistema. Possono essere eseguiti senza che nessuno se ne accorga.
Viceversa, quelli attivi alterano il funzionamento del sistema.

Gli attachi alla confidenzialità sono passivi, gli altri attivi.

L'approccio agli attacchi è completamente diverso:
* Attacchi passivi non lterano il sistema o cambiano dati
  * Sono difficili (o impossibili) da rilevare
  * Si enfatizza la prevenzione, non il rilevamento
* Attacchi attivi modificano i dati od alterano il sistema
  * Difficili da prevenire
  * Possono essere rilevati (e si può cercare di contrastarli quando si verificano)

## Meccanismi di sicurezza

I servizi di sicurezza servono a garantire il rispetto delle politiche di sicurezza.
I servizi sono implementati dai meccanismi di sicurezza. Sono gli elementi base per realizzare le varie funzionalità richieste dalle politiche.

Non esiste un unici meccanismo che supporta tutti i servizi, bisogna mettere insieme diversi meccanismi, combinandoli in un insieme di servizi richiesti dalle politiche.
Esempio: Per implementare la confidenzialità serve la crittografia, ma non basta. Dopo avere la crittografato i dati come scambio la chiave?

Bisogna saper combinare i meccanismi opportuni per implementare i servizi che vogliamo. Spesso riflettono dei meccanismi che esistono nel mondo dei documenti fisici:
* Firme
* Protezioni dall'apertura (ceralacca)
* Testimoni
* Licenze
* ...

Alcuni meccanismi specifici:
* Cifratura
  * Matematica che purtroppo non ci interessa (a me sì)
  * Per noi sono delle funzioni di libreria da chiamare e basta
* Integrità dei dati
  * Meccanismi per rilevare che un dato è cambiato
  * Si fa con checksum ed hash
* Firma digitale
  * Garantiscono l'origine dei dati
  * mettono insieme i primi due
* Scambio di autenticazione
  * Le parti si scambiano informazioni per provare la loro identità
  * Sono complicati e complessi ancora oggi
  * Anche se la cifratura è perfetta, possono esserci errori nel protocollo di autenticazione
* Traffic Padding
  * Riempire il traffico di schifezze per evitare l'analisi del traffico
  * Si usa anche nel mondo reale, per gli spostamenti delle autorità importanti
* Controllo di routing
  * Cambiare percorsi per evitare le intercettazioni
  * Per far arrivare il presidente in un posto si fanno partire 10 macchine che seguono strade diverse, all'ultimo si sceglie su quale far salire il presidente
    * Oppure per portare Harry Potter alla tana
* Notarizzation
  * Una terza parte fidata controlla la comunicazione e si occupa dei servizi, in particolare previene il ripudio
* Controllo di accesso
  * Un meccanismo per provare che un agente ha il diritto di accedere ad una certa risorsa

Non tutti i meccanismi sono utili per tutti i servizi:
| \ | Encipherment | Digital signature | Access control | Data integrity | Authentication exchange | Padding | Routing control | Notorization |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Peer entity authentication | X | X |  |  | X |  |  |  |
| Data origin authentication | X | X |  |  |  |  |  |  |
| Access control |  |  | X |  |  |  |  |  |
| Confidentiality | X |  |  |  |  |  | X |  |
| Traffic flow confidentiality | X |  |  |  |  | X | X |  |
| Data integrity | X | X |  | X |  |  |  |  |
| Non-repudiation |  | X |  | X |  |  |  | X |
| Availability |  |  |  | X | X |  |  |  |

### Modello del canale insicuro (Dolev-Yao)

Abbiamo due parti, Sender e Recipient.
Devono scambiarsi un messaggio.
Il messaggio viene inviato dal sender attraverso un canale insicuro al recipient.
Esiste un Opponent che ha pieno controllo sul canale insicuro.

L'opponent può leggere il messaggio sicuro, ritardarlo, eliminarlo, analizzarlo, ripeterlo, eccetera.

Questo è il modello dell'internet, è quello che succede normalmente se non implementiamo servizi di sicurezza.

Soluzioni:
* Il messaggio viene incapsulato in un messaggio sicuro usando un informazione segreta
  * Il recipient riceve il messaggio sicuro e lo decapsula con l'informazione segreta
  * Il messaggio sicuro può essere cifrato per non essere letto
  * Il messaggio sicuro può contenere informazioni di integrità per verificare che non sia stato modificato
  * ...
* Un arbitro fidato di terza parte controlla la comunicazione
  * Spesso non è disponibile questa opzione
  * Nel mondo reale è la posta certificata

Usare questo modello di comunicazione richiede:
* Sviluppare un algoritmo per trasformare il messaggio
  * RSA
  * AES
  * ChaCha20
  * ...
* Generare le informazioni segrete (chiavi)
  * Numero casuale
  * RSA
  * Diffie-Hellman
  * ...
* Sviluppare un metodo per condividere le informazioni segrete
  * Post-it
  * Protocolli quantistici
  * TLS
  * SSL
  * Curve25519
  * ...
* Specificare un protocollo per permettere ai programmi di utilizzare i protocolli scelti per realizzare un servizio di sicurezza
  * SSL
  * TLS
  * Wireguard
  * ...

### Dove si implementano?

Ogni strato di OSI o TCP/IP realizza un canale virtuale.

I servizi di sicurezza possono essere implementati su quasi tutti questi canali con risultati diversi.
Il meglio sarebbe implementarlo su tutti, altrimenti vengono lasciate fuori alcune informazioni che non vengono protette.

Se anche il payload del livello 4 è protetto, l'IP è scoperto e anche la porta, quindi è visibile con chi stiamo parlando e che servizio stiamo utilizzando.

Più è implementato a basso livello, più diventa complesso per gli switch e più sono le informazioni protette (più trasparente per i programmatore).
Più è implementato in alto, più è intrusivo per il programmatore e meno informazione è protetta, però è protetta meglio.


Livelli:
* Livello 1
  * "Se nessuno può collegarsi alla rete, il dato è sicuro"
    * HAHAHAHAHAHAHA
  * In generale ci si può collegare sempre in qualche modo
  * Funziona per applicazioni militari specifiche
    * I cavi coassiali subaquei erano chiusi in un tubo pressurizzato, se lo si clampa (bisogna andare con un sottomarino) per arrivare al cavo, si buca il tubo e cambia la pressione, se cambia la pressione si ferma la comunicazione
    * Ovviamente non si può fare per l'ADSL, costa
    * Se si riesce ad arrivare al cavo, la comunicazione è in chiaro
    * È cifrato anche il footer
* Livello 2
  * Si cifra il frame prima di mandarlo
  * Non si può cifrare l'intestazione di livello 2, altrimenti lo switch non sa a chi mandare il messaggio
  * Un attaccante capisce che interfacce stanno comunicando
    * I MAC sono (circa) unici, sappiamo che macchina ha parlato
  * Nel wifi è implementato da WEP e WPA
  * Il programmatore non se ne accorge
  * Al livello 3 deve arrivare decifrato, quindi hanno tutte le informazioni
  * I router possono sniffare i pacchetti se non ci sono altri strati di sicurezza
* Livello 3
  * Si cifra il payload del pacchetto
  * Non si cifra l'intestazione
  * Un attaccante sa quali host comunicano
  * È implementato da IPSec
  * Viene usato dalle VPN
  * È ancora trasparente al programmatore
  * È ancora implementato dal sistema operativo
* Livello 4
  * Si cifra il payload del livello di trasporto
  * Sono protetti i dati delle applicazioni
  * Un attaccante sa tutte le intestazioni, quindi anche il servizio richiesto
  * Sono implementati da SSL e TLS (meglio questo)
  * Non garantisce confidenzialità dei meta dati
  * Non è trasparente ai programmatori, deve utilizzare altre socket
  * Sono quasi identiche alle socket normali, ma quasi
  * Per aggiungere sicurezza di livello 4 ad un applicazione serve il codice sorgente, gli altri si fanno dal sistema operativo
  * Si usa per rendere sicuri protocolli esistenti. Si realizza lo stesso protocollo, ma sostituendo le socket
    * HTTP->HTTPS
    * POP->POPS
    * FTP->FTPS
    * ...->...S
* Livelli superiori
  * Le applicazioni fanno sicurezza interna
  * Ad esempio il PGP della mail
  * L'header dell'applicazione è scoperta
  * Si sa che comunicazione è avvenuta, solo il contenuto è sconosciuto
  * Esistono molti protocolli ad hoc implementati a questo livello
  * Non sono trasparenti in nessun modo, deve essere il programmatore a realizzare il protocollo stesso
  * Non serve intervento da parte del sistema o delle
  * Si usa per i servizi di sicurezza end-to-end